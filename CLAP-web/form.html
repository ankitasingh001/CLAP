<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
   <title>Submit the following details </title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
 

  <link rel="stylesheet" href="css/formmain.css">
  <script src="https://unpkg.com/prefixfree@1.0.0/prefixfree.min.js"></script>

  <script src="https://wzrd.in/standalone/formdata-polyfill@latest"></script>
  <script src="https://wzrd.in/standalone/promise-polyfill@latest"></script>
  <script src="https://wzrd.in/standalone/whatwg-fetch@latest"></script>
  		<script src="js/jquery.min.js"></script>
		<script src="js/skel.min.js"></script>
		<script src="js/skel-layers.min.js"></script>
		<script src="js/init.js"></script>
		<script src="js/dropdown.js"></script>
		<noscript>
			<link rel="stylesheet" href="css/skel.css" />
			<link rel="stylesheet" href="css/style.css" />
			<link rel="stylesheet" href="css/style-xlarge.css" />
			<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Special+Elite" />
		</noscript>
</head>

<body>
		<!-- Header -->
			<header id="header">
				<h1><a href="index.html">CLAP</a></h1>
				<nav id="nav">  
					<ul>
						<li><a href="index.html">Home</a></li>
						<li><a href="about.html">About</a></li>
						<li><a href="downloads.html">Downloads</a></li>
						<li><a href="offers.html">Offers</a></li>
					</ul>
				</nav>
			</header>
 
      						<section id="main" class="wrapper">
				<div class="container">
							<h3>Enter the following details:</h3>
							<p>Download links will show up after successfull submission of the form</p>
							<form method="post" name="Data_download_record" >
								<div class="row uniform 50%">
									<div class="6u 12u$(xsmall)">
										<input type="text" name="fullName" id="name" placeholder="Full Name" required/>
									</div>
									<div class="6u$ 12u$(xsmall)">
										<input type="email" name="email" id="email" value="" placeholder="Email" required/>
									</div>
									<div class="6u 12u$(xsmall)">
										<input type="text" name="occupation" id="name" value="" placeholder="Occupation" required/>
									</div>
									<div class="6u$ 12u$(xsmall)">
										<input type="text" name="affiliation" id="email" value="" placeholder="Affiliation" required/>
									</div>
				
									<div class="12u$">
										<textarea name="purpose" id="message" placeholder="Purpose of downloading the dataset" rows="6" required></textarea>
									</div>
									<div class="12u$">
										<textarea name="address" id="address" placeholder="Address" rows="6" required></textarea>
									</div>
									<div class="12u$">
										<ul class="actions">
											<li><input type="submit" value="Submit" class="button" /></li>
											<li><input type="reset" value="Reset" action="#"/></li>
										</ul>
									</div>
								</div>
							</form>
               <div class="loading js-loading is-hidden">
      <div class="loading-spinner">
        <svg><circle cx="25" cy="25" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"/></svg>
      </div>
    </div>

    <p class="js-success-message is-hidden">Success!</p>
    <p class="js-error-message is-hidden">Error!</p>
  </div>

	</section>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzeRHyIzIXHPWmcvYkPdU5qDQ_Xjvo-TzTize-7o-FlPWq78nVs/exec'
    const form = document.forms['Data_download_record']
    const loading = document.querySelector('.js-loading')
    const successMessage = document.querySelector('.js-success-message')
    const errorMessage = document.querySelector('.js-error-message')

    form.addEventListener('submit', e => {
      e.preventDefault()
      showLoadingIndicator()
      fetch(scriptURL, { method: 'POST', body: new FormData(form)})
        .then(response => showSuccessMessage(response))
        .catch(error => showErrorMessage(error))
    })

    function showLoadingIndicator () {
      form.classList.add('is-hidden')
      loading.classList.remove('is-hidden')
    }

    function showSuccessMessage (response) {
      window.location.replace("download_link.html");      
      setTimeout(() => {
        successMessage.classList.remove('is-hidden')
        loading.classList.add('is-hidden')
      }, 500)
    }

    function showErrorMessage (error) {
      console.error('Error!', error.message)
      setTimeout(() => {
        errorMessage.classList.remove('is-hidden')
        loading.classList.add('is-hidden')
      }, 500)
    }
  </script>
						</div>
						</section>


</body>
</html>
